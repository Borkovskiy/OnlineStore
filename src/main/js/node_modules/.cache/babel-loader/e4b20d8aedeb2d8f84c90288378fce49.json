{"ast":null,"code":"import _regeneratorRuntime from\"E:/\\u043F\\u0440\\u043E\\u0435\\u043A\\u0442/01.09 original/OnlineStore/src/main/js/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/\\u043F\\u0440\\u043E\\u0435\\u043A\\u0442/01.09 original/OnlineStore/src/main/js/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/\\u043F\\u0440\\u043E\\u0435\\u043A\\u0442/01.09 original/OnlineStore/src/main/js/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{createContext}from'react';import{useHistory}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";export var UserContext=/*#__PURE__*/createContext();export var UserProvider=function UserProvider(props){var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var handleClose=function handleClose(){return setShow(false);};var handleShow=function handleShow(){return setShow(true);};var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),forgotEmail=_useState4[0],setForgotEmail=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),email=_useState6[0],setEmail=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),password=_useState8[0],setPassword=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),currentEmail=_useState10[0],setCurrentEmail=_useState10[1];var _useState11=useState(undefined),_useState12=_slicedToArray(_useState11,2),status=_useState12[0],setStatus=_useState12[1];var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();data={email:email,password:password};_context.next=4;return fetch('https://online-store-120.herokuapp.com/login',{method:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(data)}).then(function(){console.log('user-info: ',data);localStorage.setItem('user-info: ',JSON.stringify(data));});case 4:_context.next=6;return getCurrentUser();case 6:history.push(\"/user\");case 7:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var handleLogout=function handleLogout(){setCurrentEmail(\"\");};var getCurrentUser=function getCurrentUser(){return fetch('user_info').then(function(res){return res.json();}).then(function(res){setCurrentEmail(res.email);});};useEffect(function(){getCurrentUser();},[]);var forgotSubmit=function forgotSubmit(e){e.preventDefault();var data={forgotEmail:forgotEmail};fetch('login',{method:'POST',headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(data)}).then(function(){setStatus({type:'success'});}).catch(function(error){setStatus({type:'error',error:error});}).then(function(){console.log('your email: ',data);});setTimeout(handleClose,3000);};return/*#__PURE__*/_jsx(UserContext.Provider,{value:{email:email,currentEmail:currentEmail,handleLogout:handleLogout,handleSubmit:handleSubmit,setEmail:setEmail,setPassword:setPassword,show:show,handleClose:handleClose,forgotSubmit:forgotSubmit,setForgotEmail:setForgotEmail,handleShow:handleShow,status:status},children:props.children});};","map":{"version":3,"sources":["E:/проект/01.09 original/OnlineStore/src/main/js/src/components/section/Registration/UserProvider.js"],"names":["React","useState","useEffect","createContext","useHistory","UserContext","UserProvider","props","history","show","setShow","handleClose","handleShow","forgotEmail","setForgotEmail","email","setEmail","password","setPassword","currentEmail","setCurrentEmail","undefined","status","setStatus","handleSubmit","e","preventDefault","data","fetch","method","headers","body","JSON","stringify","then","console","log","localStorage","setItem","getCurrentUser","push","handleLogout","res","json","forgotSubmit","type","catch","error","setTimeout","children"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { createContext } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\n\r\nexport const UserContext = createContext()\r\n\r\nexport const UserProvider = (props) => {\r\n    let history = useHistory()\r\n\r\n    const [show, setShow] = useState(false);\r\n\r\n    const handleClose = () => setShow(false);\r\n    const handleShow = () => setShow(true);\r\n    \r\n    const [forgotEmail, setForgotEmail] = useState(\"\")\r\n\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\")\r\n\r\n    const [currentEmail, setCurrentEmail] = useState(\"\")\r\n\r\n    const [status, setStatus] = useState(undefined)\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        const data = { email, password };\r\n\r\n        await fetch('https://online-store-120.herokuapp.com/login', {\r\n            method: 'POST',\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(data)\r\n        }).then(() => {\r\n            console.log('user-info: ', data)\r\n            localStorage.setItem('user-info: ', JSON.stringify(data))\r\n        });\r\n\r\n        await getCurrentUser();\r\n\r\n        history.push(\"/user\")\r\n    }\r\n\r\n    const handleLogout = () => {\r\n        setCurrentEmail(\"\")\r\n    }\r\n\r\n    const getCurrentUser = () =>\r\n        fetch('user_info')\r\n            .then((res) =>\r\n                res.json()\r\n            )\r\n    .then((res) => {\r\n        setCurrentEmail(res.email);\r\n    })\r\n\r\n    useEffect(() => {\r\n        getCurrentUser()\r\n    }, [])\r\n\r\n    const forgotSubmit = (e) => {\r\n        e.preventDefault();\r\n        const data = { forgotEmail };\r\n\r\n        fetch('login', {\r\n            method: 'POST',\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(data)\r\n        }).then(() => {\r\n            setStatus({type: 'success'});\r\n        })\r\n        .catch((error) => {\r\n            setStatus({type: 'error', error})\r\n        }).then(() => {\r\n            console.log('your email: ', data)\r\n        })\r\n        setTimeout(handleClose, 3000)\r\n    }\r\n\r\n    return (\r\n        <UserContext.Provider value={{ email, currentEmail, handleLogout, handleSubmit, setEmail, setPassword, show, handleClose, forgotSubmit, setForgotEmail, handleShow, status }}>\r\n            {props.children}\r\n        </UserContext.Provider>\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}